<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Access Token</title>
</head>
<body>
<h1>Get Access Token</h1>
<form id="getTokenForm">
    <label for="username">Username:</label>
    <input type="text" id="username" name="username" required><br><br>
    <label for="password">Password:</label>
    <input type="password" id="password" name="password" required><br><br>
    <button type="submit">Get Token</button>
</form>

<h1>Logout</h1>
<button id="logoutButton">Logout</button>

<div id="tokenDisplay"></div>

<script>
    const form = document.getElementById('getTokenForm');
    const tokenDisplay = document.getElementById('tokenDisplay');

    form.addEventListener('submit', function(event) {
        event.preventDefault();

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        fetch('http://localhost:8889/jwt/tokens', {
            method: 'POST',
            headers: {
                'Authorization': 'Basic ' + btoa(username + ':' + password)
            }
        })
            .then(response => response.json())
            .then(data => {
                tokenDisplay.innerHTML = `
                    <p>Access Token: ${data.accessToken}</p>
                    <p  style="font-size: 12px;">Access Token Expiry: ${data.accessTokenExpiry}</p>
                    <p>Refresh Token: ${data.refreshToken}</p>
                    <p  style="font-size: 12px;">Refresh Token Expiry: ${data.refreshTokenExpire}</p>
                `;

                // Дополнительные действия с токенами, например, сохранение в localStorage
                localStorage.setItem('accessToken', data.accessToken);
                localStorage.setItem('refreshToken', data.refreshToken);
            })
            .catch(error => {
                console.error('Error fetching token:', error);
                tokenDisplay.innerHTML = `<p>Error: ${error.message}</p>`;
            });
    });


    // logout
    const logoutButton = document.getElementById('logoutButton');

    logoutButton.addEventListener('click', function() {
        const refreshToken = localStorage.getItem('refreshToken');

        fetch('http://localhost:8889/jwt/logout', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + refreshToken
            }
        })
            .then(response => {
                if (response.ok) {
                    // Успешный logout
                    console.log('Logout successful');
                    // Очистка токенов из localStorage или другие действия после logout
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('refreshToken');
                } else {
                    console.error('Logout failed:', response.statusText);
                    // Дополнительная обработка ошибки, если необходимо
                }
            })
            .catch(error => {
                console.error('Error during logout:', error);
                // Обработка ошибок fetch запроса, если необходимо
            });
    });
</script>
</body>
</html>